<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ê°•ì•„ì§€ ìŠ¤ë„¤ì´í¬ (ë¶€ë“œëŸ¬ìš´ ì´ë™ + í‚¤íŒíŠ¸)</title>
<style>
  :root{
    --bg:#0b1220;
    --tileA:#223049;      /* ì²´ìŠ¤íŒ ìƒ‰ A (ì´ˆê¸°ê°’) */
    --tileB:#1a2438;      /* ì²´ìŠ¤íŒ ìƒ‰ B (ì´ˆê¸°ê°’) */
    --dog-body:#7dd3fc;   /* ëª¸í†µ ê¸°ë³¸ */
    --dog-head:#38bdf8;   /* ë¨¸ë¦¬ í•˜ì´ë¼ì´íŠ¸ */
    --dog-outline:#0e7490;
    --tongue:#ef4444;
    --meat:#d97706;       /* ê³ ê¸° */
    --meat-fat:#fff7ed;   /* ì§€ë°©/ë¼ˆ */
    --ui:#e5e7eb;
    --panel:#0f172a;
  }
  *{box-sizing:border-box}
  body{
    margin:0; min-height:100vh; background:var(--bg);
    color:var(--ui); font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    display:grid; gap:0;
    grid-template-columns: 1fr min(320px, 35vw);
  }
  #stage-wrap{display:flex; flex-direction:column; align-items:center; justify-content:center; padding:14px;}
  h1{margin:0 0 .5rem; font-size:1.1rem; font-weight:700; opacity:.9}
  canvas{background:black; border:2px solid #334155; border-radius:12px; image-rendering:pixelated}
  .hud{display:flex; gap:1.2rem; align-items:flex-start; justify-content:center; flex-wrap:wrap; margin-top:.6rem}
  .btnwrap{display:flex; flex-direction:column; align-items:center; gap:.25rem}
  .btn{background:#334155; color:white; border:none; border-radius:10px; padding:.55rem 1rem; cursor:pointer; font-weight:700; min-width:96px; text-align:center}
  .btn:active{transform:translateY(1px)}
  .hint{font-size:.8rem; opacity:.75}
  .muted{opacity:.75; font-size:.92rem; align-self:center}
  .pad{display:grid; grid-template-columns:repeat(3,56px); grid-template-rows:repeat(3,56px); gap:.4rem; margin:.4rem 0 0}
  .pad button{background:#1f2937; border:2px solid #334155; color:#cbd5e1; font-size:1rem; border-radius:10px}
  @media(min-width:720px){ .pad{display:none} }

  /* ì‚¬ì´ë“œ íŒ¨ë„ */
  aside{
    background:var(--panel); border-left:1px solid #223; padding:16px 14px;
    display:flex; flex-direction:column; gap:14px;
  }
  .panel-group{background:#0b1324; border:1px solid #213; border-radius:10px; padding:12px}
  .panel-group h3{margin:0 0 .5rem; font-size:.98rem}
  .row{display:flex; align-items:center; justify-content:space-between; gap:10px; margin:.4rem 0}
  .row label{font-size:.92rem; opacity:.9}
  select{width:160px; padding:.4rem .5rem; background:#111a2d; border:1px solid #233; color:#e5e7eb; border-radius:8px}
  .tip{font-size:.88rem; opacity:.75; line-height:1.4}
</style>
</head>
<body>
  <div id="stage-wrap">
    <h1>ê°•ì•„ì§€ ìŠ¤ë„¤ì´í¬ ğŸ¶ğŸ–</h1>
    <canvas id="game" width="420" height="420" aria-label="ê²Œì„ ìº”ë²„ìŠ¤"></canvas>

    <div class="hud">
      <div>ì ìˆ˜: <strong id="score">0</strong></div>
      <div>ìµœê³ : <strong id="best">0</strong></div>

      <div class="btnwrap">
        <button class="btn" id="toggle">ì‹œì‘</button>
        <div class="hint">(Space)</div>
      </div>

      <div class="btnwrap">
        <button class="btn" id="restart">ë‹¤ì‹œí•˜ê¸°</button>
        <div class="hint">(R)</div>
      </div>

      <span class="muted">ë°©í–¥í‚¤ / WASD</span>
    </div>

    <!-- ëª¨ë°”ì¼ ë°©í–¥íŒ¨ë“œ -->
    <div class="pad" aria-hidden="true">
      <span></span><button data-d="up">â–²</button><span></span>
      <button data-d="left">â—€</button><span></span><button data-d="right">â–¶</button>
      <span></span><button data-d="down">â–¼</button><span></span>
    </div>
  </div>

  <aside>
    <div class="panel-group">
      <h3>ì²´ìŠ¤íŒ ìƒ‰ìƒ (9ìƒ‰ ì œí•œ)</h3>
      <div class="row">
        <label for="selA">íƒ€ì¼ A</label>
        <select id="selA"></select>
      </div>
      <div class="row">
        <label for="selB">íƒ€ì¼ B</label>
        <select id="selB"></select>
      </div>
      <div class="row" style="justify-content:flex-end">
        <button class="btn" id="resetColors">ì´ˆê¸°í™”</button>
      </div>
      <p class="tip">í°/ê²€ì²˜ëŸ¼ ë°ê¸° ì°¨ê°€ í° ì¡°í•©ì´ ê°€ì¥ ì˜ ë³´ì…ë‹ˆë‹¤.</p>
    </div>
    <div class="panel-group">
      <h3>ë„ì›€ë§</h3>
      <p class="tip">ìŠ¤í˜ì´ìŠ¤ë¡œ ì‹œì‘/ì¼ì‹œì •ì§€, Rí‚¤ë¡œ ë‹¤ì‹œí•˜ê¸°. ë²½ì— ë¶€ë”ªíˆë©´ ê²Œì„ì˜¤ë²„. ìµœê³  ì ìˆ˜ëŠ” ë¸Œë¼ìš°ì €ì— ì €ì¥ë¼ìš”.</p>
    </div>
  </aside>

<script>
(() => {
  // ===== ê¸°ë³¸ ë³´ë“œ/ë Œë” ì„¤ì • =====
  const cell = 20, cols = 20, rows = 20;
  const w = cols * cell, h = rows * cell;
  const cvs = document.getElementById('game');
  const ctx = cvs.getContext('2d', { alpha:false });
  cvs.width = w; cvs.height = h;

  // HUD
  const scoreEl = document.getElementById('score');
  const bestEl  = document.getElementById('best');
  const toggleBtn = document.getElementById('toggle');
  const restartBtn= document.getElementById('restart');

  const bestKey = 'dog-snake-best';
  let best = Number(localStorage.getItem(bestKey) || 0);
  bestEl.textContent = best;

  // ===== ì‚¬ìš´ë“œ =====
  const AC = window.AudioContext || window.webkitAudioContext;
  let actx = null; function audio(){ if(!actx) actx = new AC(); }
  function beep({f=600,d=0.07,type='square',v=0.2}) {
    audio(); const t=actx.currentTime, o=actx.createOscillator(), g=actx.createGain();
    o.type=type; o.frequency.setValueAtTime(f,t);
    g.gain.setValueAtTime(0,t); g.gain.linearRampToValueAtTime(v,t+0.01);
    g.gain.exponentialRampToValueAtTime(0.0001,t+d);
    o.connect(g).connect(actx.destination); o.start(t); o.stop(t+d);
  }
  const sTurn = ()=>beep({f:520,d:0.05,type:'triangle',v:0.15});
  const sEat  = ()=>{beep({f:420,d:0.07,type:'sine',v:0.24}); setTimeout(()=>beep({f:640,d:0.07,type:'sine',v:0.24}),60);};

  // ===== ìƒíƒœ =====
  let snake, dir, pendingDir, food, score, speed, running, lastTime, acc;
  let tongueTimer = 0;

  // ë³´ê°„ìš© ìŠ¤ëƒ…ìƒ·(ì´ì „ ìŠ¤í… ìƒíƒœ)
  let prevSnake = null;
  let prevDir = {x:1,y:0};

  function init(){
    snake=[{x:10,y:10}];
    dir={x:1,y:0}; pendingDir=dir; prevDir=dir;
    score=0; speed=8; running=false; lastTime=0; acc=0; tongueTimer=0;
    food=spawnFood(); scoreEl.textContent=score;
    prevSnake = cloneSnake(snake);
    draw(0); // ì´ˆê¸° í™”ë©´
  }
  function spawnFood(){
    while(true){
      const p={x:Math.floor(Math.random()*cols), y:Math.floor(Math.random()*rows)};
      if(!snake.some(s=>s.x===p.x&&s.y===p.y)) return p;
    }
  }
  function cloneSnake(arr){ return arr.map(p=>({x:p.x, y:p.y})); }

  // ===== ì…ë ¥ =====
  const key2dir={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0},
                 w:{x:0,y:-1},s:{x:0,y:1},a:{x:-1,y:0},d:{x:1,y:0}};
  addEventListener('keydown',e=>{
    const k=e.key.toLowerCase();
    if(k in key2dir){
      const nd=key2dir[k];
      if(snake.length>1 && (nd.x===-dir.x && nd.y===-dir.y)) return;
      if(nd.x!==dir.x || nd.y!==dir.y) sTurn();
      pendingDir=nd; e.preventDefault();
    } else if(k===' '){ toggle(); e.preventDefault(); }
      else if(k==='r'){ restartBtn.click(); e.preventDefault(); }
  });
  document.querySelectorAll('.pad [data-d]').forEach(b=>{
    b.addEventListener('click',()=>{
      const map={up:{x:0,y:-1},down:{x:0,y:1},left:{x:-1,y:0},right:{x:1,y:0}};
      const nd=map[b.dataset.d];
      if(snake.length>1 && (nd.x===-dir.x && nd.y===-dir.y)) return;
      if(nd.x!==dir.x || nd.y!==dir.y) sTurn();
      pendingDir=nd;
    });
  });

  // ===== ë£¨í”„ =====
  function loop(ts){
    if(!running) return;
    const dt=(ts-lastTime)/1000; lastTime=ts; acc+=dt; tongueTimer+=dt;
    const step=1/speed;

    // 1) í•„ìš”í•œ ë§Œí¼ ìŠ¤í… ì—…ë°ì´íŠ¸ (ë²½/ëª¸ ì¶©ëŒ, ë¨¹ì´ íŒì •ì€ ê²©ì ë‹¨ìœ„)
    while(acc>=step){
      prevSnake = cloneSnake(snake);
      prevDir = {x:dir.x, y:dir.y};
      update();               // í•œ ìŠ¤í… ì§„í–‰
      acc -= step;
    }

    // 2) ë³´ê°„ ë¹„ìœ¨ t = ì§€ë‚œ ìŠ¤í… ì´í›„ ê²½ê³¼ì‹œê°„ / ìŠ¤í…ì‹œê°„ (0~1)
    const t = (acc < step) ? (acc/step) : 0;
    draw(t);

    requestAnimationFrame(loop);
  }

  function update(){
    dir=pendingDir;
    // ë²½ ì¶©ëŒ ëª¨ë“œ
    const nx = snake[0].x + dir.x;
    const ny = snake[0].y + dir.y;
    if (nx < 0 || nx >= cols || ny < 0 || ny >= rows) return gameOver();
    const head={x:nx, y:ny};

    if(snake.some((s,i)=>i>0 && s.x===head.x&&s.y===head.y)) return gameOver();

    snake.unshift(head);
    if(head.x===food.x && head.y===food.y){
      score++; scoreEl.textContent=score; speed=Math.min(16,speed+0.3); sEat(); food=spawnFood();
    } else snake.pop();
  }

  // ===== ê·¸ë¦¬ê¸° (ë³´ê°„ ë Œë”) =====
  function draw(t=0){
    drawBoard();            // ì²´í¬ë¬´ëŠ¬
    drawMeat(food.x, food.y);

    // ë³´ê°„ëœ ìœ„ì¹˜ ê³„ì‚°: prevSnake -> snake ì‚¬ì´ë¥¼ të§Œí¼
    const segCount = snake.length;
    for(let i=segCount-1;i>=0;i--){
      const cur = snake[i];
      const prv = (prevSnake && prevSnake[i]) ? prevSnake[i] : cur;
      const ix = lerp(prv.x, cur.x, t) * cell;
      const iy = lerp(prv.y, cur.y, t) * cell;

      if(i===0){
        // ë¨¸ë¦¬ëŠ” ì§„í–‰ ë°©í–¥ì„ í˜„ì¬ dir ê¸°ì¤€ìœ¼ë¡œ, ìœ„ì¹˜ëŠ” ë³´ê°„ê°’
        drawDogHeadAt(ix, iy, dir);
      }else{
        drawDogBodyAt(ix, iy);
      }
    }
  }

  function lerp(a,b,t){ return a + (b-a)*t; }

  // ì²´ìŠ¤íŒ(ì²´í¬ë¬´ëŠ¬) íƒ€ì¼ ê·¸ë¦¬ê¸°
  function drawBoard(){
    const A = getVar('--tileA') || '#223049';
    const B = getVar('--tileB') || '#1a2438';
    for(let y=0;y<rows;y++){
      for(let x=0;x<cols;x++){
        ctx.fillStyle = ((x+y)%2===0) ? A : B;
        ctx.fillRect(x*cell, y*cell, cell, cell);
      }
    }
  }

  // ë¨¹ì´: ë“œëŸ¼ìŠ¤í‹± ê³ ê¸°
  function drawMeat(cx, cy){
    const px=cx*cell, py=cy*cell, s=cell;
    const cX=px+s/2, cY=py+s/2;

    // ì‚´ì½”ê¸°
    ctx.fillStyle = getVar('--meat');
    ctx.beginPath(); ctx.ellipse(cX-s*0.1, cY, s*0.3, s*0.22, 0, 0, Math.PI*2); ctx.fill();
    ctx.strokeStyle = 'rgba(0,0,0,0.45)'; ctx.lineWidth=2; ctx.stroke();

    // ë¼ˆ ë§‰ëŒ€
    ctx.strokeStyle = getVar('--meat-fat'); ctx.lineWidth = 5;
    ctx.beginPath(); ctx.moveTo(cX+s*0.05, cY); ctx.lineTo(cX+s*0.3, cY); ctx.stroke();

    // ë¼ˆ ë ë™ê¸€
    ctx.fillStyle = getVar('--meat-fat');
    ctx.beginPath(); ctx.arc(cX+s*0.28, cY, s*0.14, 0, Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.arc(cX+s*0.38, cY, s*0.10, 0, Math.PI*2); ctx.fill();

    // í•˜ì´ë¼ì´íŠ¸
    ctx.fillStyle = 'rgba(255,255,255,0.18)';
    ctx.beginPath(); ctx.ellipse(cX-s*0.18, cY-3, s*0.10, s*0.07, -0.3, 0, Math.PI*2); ctx.fill();
  }

  // ê°•ì•„ì§€ ëª¸í†µ(ë³´ê°„ ì¢Œí‘œ ë²„ì „)
  function drawDogBodyAt(ix, iy){
    const r=cell*0.42, cx=ix+cell/2, cy=iy+cell/2;
    const g=ctx.createRadialGradient(cx, cy, r*0.35, cx, cy, r);
    g.addColorStop(0, getVar('--dog-head')); g.addColorStop(1, getVar('--dog-body'));
    ctx.fillStyle=g; ctx.beginPath(); ctx.arc(cx, cy, r, 0, Math.PI*2); ctx.fill();

    ctx.strokeStyle=getVar('--dog-outline'); ctx.lineWidth=2;
    ctx.beginPath(); ctx.arc(cx, cy, r, 0, Math.PI*2); ctx.stroke();

    // í„¸ ê´‘íƒ ì 
    ctx.fillStyle='rgba(255,255,255,0.08)';
    ctx.beginPath(); ctx.arc(cx+2, cy-2, 2, 0, Math.PI*2); ctx.fill();
  }

  // ê°•ì•„ì§€ ë¨¸ë¦¬(ë³´ê°„ ì¢Œí‘œ ë²„ì „)
  function drawDogHeadAt(ix, iy, dirNow){
    const r=cell*0.46;
    const cx=ix+cell/2, cy=iy+cell/2;

    // ë¨¸ë¦¬
    const g=ctx.createRadialGradient(cx-2*dirNow.x, cy-2*dirNow.y, r*0.35, cx, cy, r);
    g.addColorStop(0, getVar('--dog-head')); g.addColorStop(1, getVar('--dog-body'));
    ctx.fillStyle=g; ctx.beginPath(); ctx.arc(cx, cy, r, 0, Math.PI*2); ctx.fill();

    ctx.strokeStyle=getVar('--dog-outline'); ctx.lineWidth=2;
    ctx.beginPath(); ctx.arc(cx, cy, r, 0, Math.PI*2); ctx.stroke();

    // ê·€
    const earOffset = 6, earBack = 6;
    drawEar(cx - dirNow.x*earBack + (-dirNow.y)*earOffset,
            cy - dirNow.y*earBack + ( dirNow.x)*earOffset, dirNow, true);
    drawEar(cx - dirNow.x*earBack + ( dirNow.y)*earOffset,
            cy - dirNow.y*earBack + (-dirNow.x)*earOffset, dirNow, false);

    // ëˆˆ
    const eyeOffset = 6, eyeSide = 7;
    const ex1 = cx + (-dirNow.y)*eyeSide + dirNow.x*eyeOffset;
    const ey1 = cy + ( dirNow.x)*eyeSide + dirNow.y*eyeOffset;
    const ex2 = cx + ( dirNow.y)*eyeSide + dirNow.x*eyeOffset;
    const ey2 = cy + (-dirNow.x)*eyeSide + dirNow.y*eyeOffset;
    ctx.fillStyle='white';
    ctx.beginPath(); ctx.arc(ex1,ey1,4,0,Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.arc(ex2,ey2,4,0,Math.PI*2); ctx.fill();
    // ë™ê³µ
    const pupilShift = 1.8;
    ctx.fillStyle='#0b1220';
    ctx.beginPath(); ctx.arc(ex1+dirNow.x*pupilShift, ey1+dirNow.y*pupilShift, 2, 0, Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.arc(ex2+dirNow.x*pupilShift, ey2+dirNow.y*pupilShift, 2, 0, Math.PI*2); ctx.fill();

    // ì½”
    const nx = cx + dirNow.x*(r*0.55), ny = cy + dirNow.y*(r*0.55);
    ctx.fillStyle='#111827';
    ctx.beginPath(); ctx.arc(nx, ny, 3, 0, Math.PI*2); ctx.fill();

    // í˜€ (ê°„í—ì )
    const showTongue = (Math.floor(tongueTimer*5)%5===0);
    if(showTongue){
      const tx = cx + dirNow.x*(r+2), ty = cy + dirNow.y*(r+2);
      ctx.strokeStyle=getVar('--tongue'); ctx.lineWidth=2;
      ctx.beginPath(); ctx.moveTo(tx,ty); ctx.lineTo(tx+dirNow.x*7, ty+dirNow.y*7); ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(tx+dirNow.x*7, ty+dirNow.y*7);
      ctx.lineTo(tx+dirNow.x*9 + (dirNow.y*2), ty+dirNow.y*9 + (-dirNow.x*2));
      ctx.moveTo(tx+dirNow.x*7, ty+dirNow.y*7);
      ctx.lineTo(tx+dirNow.x*9 + (-dirNow.y*2), ty+dirNow.y*9 + ( dirNow.x*2));
      ctx.stroke();
    }
  }

  function drawEar(x, y, dirNow, left){
    ctx.fillStyle=getVar('--dog-body');
    ctx.strokeStyle=getVar('--dog-outline');
    ctx.lineWidth=2;
    ctx.beginPath();
    const s=6;
    ctx.moveTo(x, y);
    ctx.lineTo(x - dirNow.x*2 + ( left? -dirNow.y : dirNow.y)*s, y - dirNow.y*2 + ( left?  dirNow.x : -dirNow.x)*s);
    ctx.lineTo(x - dirNow.x*2 + ( left?  dirNow.y : -dirNow.y)*s, y - dirNow.y*2 + ( left? -dirNow.x :  dirNow.x)*s);
    ctx.closePath(); ctx.fill(); ctx.stroke();
  }

  function getVar(name){ return getComputedStyle(document.documentElement).getPropertyValue(name).trim(); }

  // ===== ì»¨íŠ¸ë¡¤ =====
  function toggle(){ running=!running; toggleBtn.textContent=running?'ì¼ì‹œì •ì§€':'ì‹œì‘';
    if(running){ audio(); lastTime=performance.now(); requestAnimationFrame(loop); } }
  function gameOver(){
    running=false; toggleBtn.textContent='ì‹œì‘';
    best=Math.max(best,score); localStorage.setItem(bestKey,best); bestEl.textContent=best;
    alert(`ê²Œì„ ì˜¤ë²„! ì ìˆ˜: ${score}`);
  }
  toggleBtn.addEventListener('click',toggle);
  restartBtn.addEventListener('click',()=>init());

  // í‚¤ë³´ë“œ Rë¡œ ë‹¤ì‹œí•˜ê¸°
  // (keydownì—ì„œ r ì²˜ë¦¬ â†’ restartBtn.click())

  init();

  // ===== 9ìƒ‰ íŒ”ë ˆíŠ¸ ì…€ë ‰í„° =====
  const PRESETS = [
    {name:'í°', hex:'#ffffff'},
    {name:'ê²€', hex:'#000000'},
    {name:'ë¹¨', hex:'#ff0000'},
    {name:'ì£¼', hex:'#ff7f00'},
    {name:'ë…¸', hex:'#ffff00'},
    {name:'ì´ˆ', hex:'#00ff00'},
    {name:'íŒŒ', hex:'#0000ff'},
    {name:'ë‚¨', hex:'#000080'},
    {name:'ë³´', hex:'#800080'}
  ];
  const selA = document.getElementById('selA');
  const selB = document.getElementById('selB');
  const resetBtn = document.getElementById('resetColors');

  function fillSelect(sel, currentHex){
    sel.innerHTML='';
    PRESETS.forEach(p=>{
      const opt=document.createElement('option');
      opt.value=p.hex; opt.textContent=`${p.name} (${p.hex})`;
      if ((currentHex||'').toLowerCase()===p.hex.toLowerCase()) opt.selected=true;
      sel.appendChild(opt);
    });
  }
  function currentHex(varName, fallback){
    const v=getVar(varName);
    if(/^#/.test(v)) return v;
    const m=v.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/i);
    if(!m) return fallback;
    const r=Number(m[1]).toString(16).padStart(2,'0');
    const g=Number(m[2]).toString(16).padStart(2,'0');
    const b=Number(m[3]).toString(16).padStart(2,'0');
    return `#${r}${g}${b}`;
  }
  // ì´ˆê¸° ì˜µì…˜ êµ¬ì„±
  fillSelect(selA, currentHex('--tileA', '#223049'));
  fillSelect(selB, currentHex('--tileB', '#1a2438'));

  selA.addEventListener('change', e=>{
    document.documentElement.style.setProperty('--tileA', e.target.value);
    draw(0);
  });
  selB.addEventListener('change', e=>{
    document.documentElement.style.setProperty('--tileB', e.target.value);
    draw(0);
  });
  resetBtn.addEventListener('click', ()=>{
    document.documentElement.style.setProperty('--tileA', '#223049');
    document.documentElement.style.setProperty('--tileB', '#1a2438');
    fillSelect(selA, '#223049');
    fillSelect(selB, '#1a2438');
    draw(0);
  });
})();
</script>
</body>
</html>
