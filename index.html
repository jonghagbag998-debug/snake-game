<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>ê°•ì•„ì§€ ìŠ¤ë„¤ì´í¬ (íŒŒìŠ¤í…”+ë³´ë“œì‚¬ì´ì¦ˆ+ì„¤ì •ë²„íŠ¼)</title>
<style>
:root{
  --bg:#0b1220;--ui:#e5e7eb;--panel:#0f172a;
  --tileA:#CDE7FF;--tileB:#B8F2E6;        /* íŒŒìŠ¤í…” ê¸°ë³¸ */
  --dog1:#86e1ff;--dog2:#bfe8ff;--dogo:#0e7490;--tongue:#ef4444;
  --meat:#ffb085;--bone:#fff7ed
}
*{box-sizing:border-box}body{margin:0;min-height:100vh;background:var(--bg);color:var(--ui);
display:grid;grid-template-columns:1fr min(340px,36vw);font-family:system-ui,Segoe UI,Roboto,sans-serif}
h1{margin:0 0 .6rem;font-size:1.1rem}
#stage{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:14px}
canvas{background:#000;border:2px solid #334155;border-radius:12px}
.hud{display:flex;gap:1rem;align-items:flex-start;justify-content:center;flex-wrap:wrap;margin-top:.6rem}
.btn{background:#334155;color:#fff;border:0;border-radius:10px;padding:.55rem 1rem;min-width:96px;cursor:pointer;font-weight:700}
.hint{font-size:.8rem;opacity:.75;text-align:center;margin-top:.25rem}
.muted{opacity:.75;font-size:.92rem;align-self:center}
aside{background:var(--panel);border-left:1px solid #223;padding:16px 14px;display:flex;flex-direction:column;gap:14px}
.box{background:#0b1324;border:1px solid #213;border-radius:10px;padding:12px}
.row{display:flex;align-items:center;justify-content:space-between;gap:10px;margin:.4rem 0}
.tip{font-size:.88rem;opacity:.75;line-height:1.4}
.swatch-grid{display:grid;grid-template-columns:repeat(9,1fr);gap:6px}
.swatch{height:26px;border-radius:6px;border:2px solid #243047;cursor:pointer}
.swatch.active{outline:2px solid #fff;outline-offset:1px}
.pad{display:grid;grid-template-columns:repeat(3,56px);grid-template-rows:repeat(3,56px);gap:.4rem;margin-top:.4rem}
.pad button{background:#1f2937;border:2px solid #334155;color:#cbd5e1;font-size:1rem;border-radius:10px}
@media(min-width:720px){.pad{display:none}}
/* ëª¨ë‹¬ */
.backdrop{position:fixed;inset:0;background:rgba(0,0,0,.6);display:flex;align-items:center;justify-content:center;z-index:10}
.modal{width:min(500px,92vw);background:#0f172a;border:1px solid #2b3350;border-radius:14px;padding:16px;box-shadow:0 10px 40px #0006}
.radios{display:flex;gap:.6rem;flex-wrap:wrap}
.radios label{display:flex;align-items:center;gap:.4rem;background:#0b1324;border:1px solid #223;padding:.45rem .6rem;border-radius:8px;cursor:pointer}
.ghost{background:#1b2541}
.stack{display:flex;flex-direction:column;align-items:center}
select{width:100%;padding:.45rem;border-radius:8px;border:1px solid #233;background:#0b1324;color:var(--ui)}
</style>
</head>
<body>
  <div id="stage">
    <h1>ê°•ì•„ì§€ ìŠ¤ë„¤ì´í¬ ğŸ¶ğŸ–</h1>
    <canvas id="cv" width="420" height="420" aria-label="game"></canvas>

    <div class="hud">
      <div>ì ìˆ˜: <b id="score">0</b></div>
      <div>ìµœê³ : <b id="best">0</b></div>

      <div class="stack">
        <button class="btn" id="btnStart">ì‹œì‘</button><div class="hint">(Space)</div>
      </div>
      <div class="stack">
        <button class="btn" id="btnRestart">ë‹¤ì‹œí•˜ê¸°</button><div class="hint">(R)</div>
      </div>
      <span class="muted">ë°©í–¥í‚¤ / WASD</span>
    </div>

    <!-- ëª¨ë°”ì¼ íŒ¨ë“œ -->
    <div class="pad" aria-hidden="true">
      <span></span><button data-d="up">â–²</button><span></span>
      <button data-d="left">â—€</button><span></span><button data-d="right">â–¶</button>
      <span></span><button data-d="down">â–¼</button><span></span>
    </div>
  </div>

  <aside>
    <div class="box">
      <h3>ì²´ìŠ¤íŒ ìƒ‰ìƒ (íŒŒìŠ¤í…” 9ìƒ‰)</h3>
      <div class="row" style="flex-direction:column;align-items:stretch;gap:8px">
        <div>íƒ€ì¼ A</div>
        <div id="swA" class="swatch-grid"></div>
      </div>
      <div class="row" style="flex-direction:column;align-items:stretch;gap:8px">
        <div>íƒ€ì¼ B</div>
        <div id="swB" class="swatch-grid"></div>
      </div>
      <div class="row" style="justify-content:flex-end"><button class="btn" id="reset">ì´ˆê¸°í™”</button></div>
    </div>

    <div class="box">
      <h3>ë„ì›€ë§</h3>
      <p class="tip">ì‹œì‘ íŒì—…ì—ì„œ <b>ë¨¹ì´ ê°œìˆ˜ / ë‚œì´ë„ / ê²Œì„íŒ í¬ê¸°</b>ë¥¼ ì •í•œ ë’¤ ì‹œì‘í•˜ì„¸ìš”. ì†ë„ëŠ” ë‚œì´ë„ë¡œ ê³ ì •ë©ë‹ˆë‹¤.</p>
      <div class="row" style="justify-content:flex-end"><button class="btn" id="openSettings">ì„¤ì •</button></div>
    </div>
  </aside>

  <!-- ì‹œì‘ ì„¤ì • ëª¨ë‹¬ -->
  <div class="backdrop" id="modal">
    <div class="modal">
      <h2>ê²Œì„ ì‹œì‘ ì„¤ì •</h2>

      <div class="row" style="flex-direction:column;align-items:flex-start">
        <label for="foodCnt">ë™ì‹œì— ë“±ì¥í•˜ëŠ” ë¨¹ì´ (1~10)</label>
        <select id="foodCnt">
          <option>1</option><option>2</option><option selected>3</option><option>4</option><option>5</option>
          <option>6</option><option>7</option><option>8</option><option>9</option><option>10</option>
        </select>
      </div>

      <div class="row" style="flex-direction:column;align-items:flex-start">
        <label for="boardSize">ê²Œì„íŒ í¬ê¸°</label>
        <select id="boardSize">
          <option>7Ã—7</option><option>10Ã—10</option><option selected>15Ã—15</option>
          <option>20Ã—20</option><option>25Ã—25</option>
        </select>
      </div>

      <div style="margin:.3rem 0 .6rem">ë‚œì´ë„</div>
      <div class="radios" id="diff">
        <label><input type="radio" name="d" value="easy" checked>Easy(ëŠë¦¼)</label>
        <label><input type="radio" name="d" value="medium">Medium(ì¤‘ê°„)</label>
        <label><input type="radio" name="d" value="hard">Hard(ë¹ ë¦„)</label>
      </div>

      <div class="row" style="justify-content:flex-end;margin-top:10px">
        <button class="btn ghost" id="mCancel">ì·¨ì†Œ</button>
        <button class="btn" id="mStart">ê²Œì„ ì‹œì‘</button>
      </div>
      <p class="tip" style="margin:.4rem 0 0">Spaceë¡œë„ ì‹œì‘ ê°€ëŠ¥. Rí‚¤ë¡œ ê°™ì€ ì„¤ì •ìœ¼ë¡œ ì¬ì‹œì‘.</p>
    </div>
  </div>

<script>
(()=>{ // ===== helpers & constants =====
const $=id=>document.getElementById(id), CSS=document.documentElement.style;
const SPD={easy:6,medium:9,hard:13};                     // ê³ ì • ì†ë„
const PASTEL=[                                           // 9ìƒ‰ íŒŒìŠ¤í…”
  ['í¬ë¦¼','#FFF1C1'],['ë¯¼íŠ¸','#B8F2E6'],['í•˜ëŠ˜','#CDE7FF'],
  ['ë¼ì¼ë½','#E9D5FF'],['ì½”ë„','#FFC9C9'],['ë³µìˆ­ì•„','#FFD6A5'],
  ['ë ˆëª¬','#FEF08A'],['ìƒˆë²½ì´ˆë¡','#CDE9D6'],['ì—°íšŒìƒ‰','#D1D5DB']
];

const cv=$('cv'), g=cv.getContext('2d',{alpha:false});
let COL=15, ROW=15, CELL=28, CW=COL*CELL, CH=ROW*CELL;
function resizeBoard(size){            // size = 7|10|15|20|25
  COL=ROW=size; CELL=Math.floor(420/size); CW=COL*CELL; CH=ROW*CELL;
  cv.width=CW; cv.height=CH;
}

const scoreEl=$('score'), bestEl=$('best'), bStart=$('btnStart'), bRestart=$('btnRestart');
const modal=$('modal'), mStart=$('mStart'), mCancel=$('mCancel'), foodSel=$('foodCnt'), diffWrap=$('diff'), boardSel=$('boardSize');
const openSettings=$('openSettings'), resetBtn=$('reset');

// ===== swatch color picker (íƒ€ì¼ A/B) =====
function buildSwatches(containerId, cssVar, initial){
  const box=$(containerId); box.innerHTML='';
  PASTEL.forEach(([label,hex],i)=>{
    const b=document.createElement('button');
    b.className='swatch'; b.title=label; b.style.background=hex;
    if((getComputedStyle(document.documentElement).getPropertyValue(cssVar).trim()||initial)===hex) b.classList.add('active');
    b.onclick=()=>{ [...box.children].forEach(x=>x.classList.remove('active')); b.classList.add('active');
      CSS.setProperty(cssVar, hex); draw(0); };
    box.appendChild(b);
  });
}
buildSwatches('swA','--tileA','#CDE7FF');
buildSwatches('swB','--tileB','#B8F2E6');
resetBtn.onclick=()=>{ CSS.setProperty('--tileA','#CDE7FF'); CSS.setProperty('--tileB','#B8F2E6');
  buildSwatches('swA','--tileA','#CDE7FF'); buildSwatches('swB','--tileB','#B8F2E6'); draw(0); };

// ===== state =====
let best=+localStorage.getItem('dog-snake-best')||0; bestEl.textContent=best;
let running=false,snake,prev,dir,pdir,foods=[],score=0,speed=SPD.easy,last=0,acc=0,tongue=0;
const AC=window.AudioContext||window.webkitAudioContext; let ac;
const beep=(f=600,d=0.07,type='square',v=0.2)=>{ (ac||(ac=new AC())).resume&&ac.resume();
  const t=ac.currentTime,o=ac.createOscillator(),q=ac.createGain();o.type=type;o.frequency.setValueAtTime(f,t);
  q.gain.setValueAtTime(0,t);q.gain.linearRampToValueAtTime(v,t+.01);q.gain.exponentialRampToValueAtTime(.0001,t+d);
  o.connect(q).connect(ac.destination);o.start(t);o.stop(t+d)};
const sTurn=()=>beep(520,.05,'triangle',.15), sEat=()=>{beep(420,.07,'sine',.24);setTimeout(()=>beep(640,.07,'sine',.24),60)};

// ===== game core =====
function copy(a){ return a.map(p=>({x:p.x,y:p.y})) }
const R= n=>Math.floor(Math.random()*n);
function spawn(){ while(1){ const p={x:R(COL),y:R(ROW)};
  if(!snake?.some(s=>s.x==p.x&&s.y==p.y) && !foods.some(f=>f.x==p.x&&f.y==p.y)) return p; } }
function board(){ const cs=getComputedStyle(document.documentElement),A=cs.getPropertyValue('--tileA').trim(),B=cs.getPropertyValue('--tileB').trim();
  for(let y=0;y<ROW;y++)for(let x=0;x<COL;x++){ g.fillStyle=((x+y)&1)?B:A; g.fillRect(x*CELL,y*CELL,CELL,CELL) } }
const lerp=(a,b,t)=>a+(b-a)*t;

function circle(cx,cy,r,fill,sw=0,sc='#000'){ if(fill){g.fillStyle=fill; g.beginPath(); g.arc(cx,cy,r,0,Math.PI*2); g.fill()}
  if(sw){g.strokeStyle=sc; g.lineWidth=sw; g.beginPath(); g.arc(cx,cy,r,0,Math.PI*2); g.stroke()} }
function grad(cx,cy,r,dx,dy){ const q=g.createRadialGradient(cx-2*dx,cy-2*dy,r*.35,cx,cy,r);
  q.addColorStop(0,getComputedStyle(document.documentElement).getPropertyValue('--dog1')); 
  q.addColorStop(1,getComputedStyle(document.documentElement).getPropertyValue('--dog2')); return q }
function ear(x,y,d,left){ g.fillStyle=getComputedStyle(document.documentElement).getPropertyValue('--dog2');
  g.strokeStyle=getComputedStyle(document.documentElement).getPropertyValue('--dogo'); g.lineWidth=2; const s=6;
  g.beginPath(); g.moveTo(x,y);
  g.lineTo(x - d.x*2 + ( left? -d.y : d.y)*s, y - d.y*2 + ( left?  d.x : -d.x)*s);
  g.lineTo(x - d.x*2 + ( left?  d.y : -d.y)*s, y - d.y*2 + ( left? -d.x :  d.x)*s);
  g.closePath(); g.fill(); g.stroke() }
function head(x,y,d){ const r=CELL*.46,cx=x+CELL/2,cy=y+CELL/2,ox=getComputedStyle(document.documentElement).getPropertyValue('--dogo');
  circle(cx,cy,r,grad(cx,cy,r,d.x,d.y),2,ox);
  const eo=6,es=7,ex1=cx+(-d.y)*es+d.x*eo,ey1=cy+( d.x)*es+d.y*eo,ex2=cx+( d.y)*es+d.x*eo,ey2=cy+(-d.x)*es+d.y*eo;
  circle(ex1,ey1,4,'#fff'); circle(ex2,ey2,4,'#fff'); circle(ex1+d.x*1.8,ey1+d.y*1.8,2,'#0b1220'); circle(ex2+d.x*1.8,ey2+d.y*1.8,2,'#0b1220');
  circle(cx+d.x*(r*.55),cy+d.y*(r*.55),3,'#111827'); ear(cx - d.x*6 + (-d.y)*6, cy - d.y*6 + ( d.x)*6, d,true);
  ear(cx - d.x*6 + ( d.y)*6, cy - d.y*6 + (-d.x)*6, d,false);
  if((Math.floor(tongue*5)%5)==0){ g.strokeStyle=getComputedStyle(document.documentElement).getPropertyValue('--tongue'); g.lineWidth=2;
    const tx=cx+d.x*(r+2),ty=cy+d.y*(r+2); g.beginPath(); g.moveTo(tx,ty); g.lineTo(tx+d.x*7,ty+d.y*7); g.stroke();
    g.beginPath(); g.moveTo(tx+d.x*7,ty+d.y*7); g.lineTo(tx+d.x*9 + d.y*2,ty+d.y*9 - d.x*2);
    g.moveTo(tx+d.x*7,ty+d.y*7); g.lineTo(tx+d.x*9 - d.y*2,ty+d.y*9 + d.x*2); g.stroke() }
}
function body(x,y){ const r=CELL*.42,cx=x+CELL/2,cy=y+CELL/2; circle(cx,cy,r,grad(cx,cy,r,0,0),2,getComputedStyle(document.documentElement).getPropertyValue('--dogo'));
  circle(cx+2,cy-2,2,'rgba(255,255,255,.08)') }
function meat(cx,cy){ const x=cx*CELL,y=cy*CELL,s=CELL,cx2=x+s/2,cy2=y+s/2;
  g.fillStyle=getComputedStyle(document.documentElement).getPropertyValue('--meat');
  g.beginPath(); g.ellipse(cx2-s*.1,cy2,s*.3,s*.22,0,0,Math.PI*2); g.fill();
  g.strokeStyle='rgba(0,0,0,.45)'; g.lineWidth=2; g.stroke();
  g.strokeStyle=getComputedStyle(document.documentElement).getPropertyValue('--bone'); g.lineWidth=5;
  g.beginPath(); g.moveTo(cx2+s*.05,cy2); g.lineTo(cx2+s*.3,cy2); g.stroke();
  g.fillStyle=getComputedStyle(document.documentElement).getPropertyValue('--bone'); g.beginPath(); g.arc(cx2+s*.28,cy2,s*.14,0,Math.PI*2); g.fill();
  g.beginPath(); g.arc(cx2+s*.38,cy2,s*.10,0,Math.PI*2); g.fill();
  g.fillStyle='rgba(255,255,255,.18)'; g.beginPath(); g.ellipse(cx2-s*.18,cy2-3,s*.10,s*.07,-.3,0,Math.PI*2); g.fill()
}

function draw(t=0){
  board(); foods.forEach(f=>meat(f.x,f.y));
  for(let i=snake.length-1;i>=0;i--){ const c=snake[i], p=prev[i]||c, x=(p.x+(c.x-p.x)*t)*CELL, y=(p.y+(c.y-p.y)*t)*CELL; i?body(x,y):head(x,y,dir) }
}

function update(){
  dir=pdir; const nx=snake[0].x+dir.x, ny=snake[0].y+dir.y;
  if(nx<0||ny<0||nx>=COL||ny>=ROW) return gameOver();
  const head={x:nx,y:ny}; if(snake.some((s,i)=>i&&s.x==nx&&s.y==ny)) return gameOver();
  snake.unshift(head);
  const k=foods.findIndex(f=>f.x==nx&&f.y==ny);
  if(k>-1){ scoreEl.textContent=++score; sEat(); foods.splice(k,1); foods.push(spawn()); } else snake.pop();
}

let last=0;
function loop(ts){ if(!running) return; const dt=(ts-last)/1000; last=ts; acc+=dt; tongue+=dt; const step=1/speed;
  while(acc>=step){ prev=copy(snake); update(); acc-=step } draw(acc/step); requestAnimationFrame(loop) }

function start(){ running=true; bStart.textContent='ì¼ì‹œì •ì§€'; (ac||(ac=new AC())).resume?.(); last=performance.now(); requestAnimationFrame(loop) }
function stop(){ running=false; bStart.textContent='ì‹œì‘' }
function gameOver(){ stop(); best=Math.max(best,score); bestEl.textContent=best; localStorage.setItem('dog-snake-best',best); alert(`ê²Œì„ ì˜¤ë²„! ì ìˆ˜: ${score}`) }

// ===== init / settings =====
function init(startNow=false){
  // ë³´ë“œ í¬ê¸° ë°˜ì˜
  const szTxt=boardSel.value||'15Ã—15', sz=+szTxt.split('Ã—')[0]; resizeBoard(sz);
  // ë‚œì´ë„/ì†ë„
  speed=SPD[(diffWrap.querySelector('input[name="d"]:checked')||{value:'easy'}).value];
  // ë¨¹ì´
  foods.length=0; for(let i=(+foodSel.value||3); i--;) foods.push(spawn());
  // ë±€
  snake=[{x:Math.floor(COL/2),y:Math.floor(ROW/2)}]; dir=pdir={x:1,y:0}; prev=copy(snake);
  // ìŠ¤ì½”ì–´/ìƒíƒœ
  score=0; scoreEl.textContent=0; acc=0; tongue=0; draw(0); if(startNow) start();
}

const isModalOpen=()=>modal.style.display!=='none', openModal=()=>modal.style.display='flex', closeModal=()=>modal.style.display='none';
$('mStart').onclick=()=>{ closeModal(); init(true) };
$('mCancel').onclick=()=>closeModal();
$('openSettings').onclick=()=>openModal();

const keyDir={arrowup:{x:0,y:-1},w:{x:0,y:-1},arrowdown:{x:0,y:1},s:{x:0,y:1},arrowleft:{x:-1,y:0},a:{x:-1,y:0},arrowright:{x:1,y:0},d:{x:1,y:0}};
document.onkeydown=e=>{
  const k=e.key.toLowerCase();
  if(keyDir[k]){ const nd=keyDir[k]; if(snake?.length>1 && nd.x==-dir.x && nd.y==-dir.y) return;
    if(nd.x!=dir.x||nd.y!=dir.y) sTurn(); pdir=nd; e.preventDefault(); return }
  if (k === ' ') {
  if (isModalOpen()) $('mStart').click();
  else if (!snake || foods.length === 0) init(true);
  else (running ? stop() : start());
  e.preventDefault(); return;
}

  if(k==='r'){ init(true); e.preventDefault() }
};
document.querySelectorAll('.pad [data-d]').forEach(b=>b.onclick=()=>{const m={up:{x:0,y:-1},down:{x:0,y:1},left:{x:-1,y:0},right:{x:1,y:0}},nd=m[b.dataset.d];
  if(snake.length>1 && nd.x==-dir.x && nd.y==-dir.y) return; if(nd.x!=dir.x||nd.y!=dir.y) sTurn(); pdir=nd });

$('btnStart').onclick = () => {
  if (isModalOpen()) { $('mStart').click(); return; }
  if (!snake || foods.length === 0) { init(true); return; }
  running ? stop() : start();
};

// ì²« í™”ë©´: ëª¨ë‹¬ ì˜¤í”ˆ + ê¸°ë³¸ ë³´ë“œ ë Œë”
openModal(); resizeBoard(15); snake=[{x:7,y:7}]; prev=copy(snake); dir=pdir={x:1,y:0}; foods=[]; draw(0);
})();
</script>
</body>
</html>
